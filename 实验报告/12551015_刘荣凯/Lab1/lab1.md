### 1. 内存分配大小分析

在调试过程中，通过观察内存状态，填写下表，记录不同请求大小对应的实际分配大小。

| 请求分配大小 | 实际分配大小 | 分析与说明 |
| :------- | :------ | :--------- |
| 96 字节   |   128B      |   元数据是32字节，加上请求96字节        |
| 128 字节  |   256B      |   元数据是32字节，加上请求128字节，是160字节，但被salloc对齐到256字节        |
| 256 字节  |   384B     |    元数据是32字节，加上请求256字节，是288字节，但被salloc对齐到384字节         |
| 4064 字节 |   4096B     |   元数据是32字节，加上请求4064字节，是4096字节          |
| 4096 字节 |   8192B     |   元数据是32字节，加上请求4096字节，是4128字节，超过一个页面，使用palloc分配两个页面（8192字节）          |


### 2. 核心问题

问题1:

salloc最小单元： 128B

定义：
```
#define __S_PAGE_SHIFT 7
#define __S_PAGE_SIZE (1ULL << __S_PAGE_SHIFT) 
```
palloc最小单元： 4KB
定义：
```
#define PAGE_SIZE 0x1000UL
```

问题2:
uk_malloc()` 函数通过IS_SMALL函数来判断（请求数据+元数据<页面大小的五分之一），如果满足条件，就选择salloc分配，否则选择palloc分配。

问题3:
palloc在free()时，并没有传递small，导致使用默认值进行传输，uk_free_ifpages得到错误输入。

解决方案：使用set small = 0来强制设置small为0，确保uk_free_ifpages走正确的分支。



